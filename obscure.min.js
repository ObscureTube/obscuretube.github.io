var ids=[""];var cids=[""];var descs=[""];var blockedChannels=[""];var seenVideos=[""];var playerReady=false;var lastSkipTime=0;var autoSkipWasEnabled=false;var hasVidParam=false;var player,currentVideoIndex=0;function onYouTubeIframeAPIReady(){player=new YT.Player("player",{height:"100%",width:"100%",events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})}function onPlayerReady(event){event.target.loadVideoById(ids[currentVideoIndex]);document.getElementById("videoLink").value="https://share.obscuretube.com?v="+ids[currentVideoIndex];playerReady=true}function onPlayerStateChange(event){if(event.data==YT.PlayerState.ENDED){nextSelect()}}function getVideoCountForChannel(){var count=0;for(let i=0,len=cids.length;i<len;i++){if(cids[i]==cids[currentVideoIndex]){count++}}return count-1}function parse_query_string(query){var vars=query.split("&");var query_string={};for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");var key=decodeURIComponent(pair[0]);var value=decodeURIComponent(pair[1]);if(typeof query_string[key]==="undefined"){query_string[key]=decodeURIComponent(value)}else if(typeof query_string[key]==="string"){var arr=[query_string[key],decodeURIComponent(value)];query_string[key]=arr}else{query_string[key].push(decodeURIComponent(value))}}return query_string}function autoSkipEnable(){document.getElementById("autoSkipCheck").checked=true;document.getElementById("autoSkipVal").disabled=false;lastSkipTime=Date.now();document.getElementById("autoSkipVal").style.color="#5B8C17";var all=document.getElementsByClassName("autoSkip");for(var i=0;i<all.length;i++){all[i].style.color="#5B8C17"}}function autoSkipDisable(){document.getElementById("autoSkipCheck").checked=false;document.getElementById("autoSkipVal").disabled=true;document.getElementById("autoSkipVal").style.color="";var all=document.getElementsByClassName("autoSkip");for(var i=0;i<all.length;i++){all[i].style.color="#FD6149"}}function autoSkipClick(){var chk=document.getElementById("autoSkipCheck").checked;if(!chk){autoSkipEnable()}else{autoSkipDisable();autoSkipWasEnabled=false}}function redirectToHome(){window.location.href="https://obscuretube.com"}function displaySharedContext(){document.getElementById("sharedContext").hidden=false}function nextClicked(){if(hasVidParam){redirectToHome();return}hideAbout();nextSelect()}function nextSelect(){if(hasVidParam){displaySharedContext();return}var foundVideo=false;while(currentVideoIndex+1<ids.length){currentVideoIndex++;localStorage.setItem(ids[currentVideoIndex],"sv");if(!blockedChannels.includes(cids[currentVideoIndex])&&!seenVideos.includes(ids[currentVideoIndex])){player.loadVideoById(ids[currentVideoIndex]);document.getElementById("videoLink").value="https://share.obscuretube.com/?v="+ids[currentVideoIndex];document.getElementById("channelCount").innerHTML=getVideoCountForChannel();lastSkipTime=Date.now();if(autoSkipWasEnabled){autoSkipEnable()}foundVideo=true;break}}if(!foundVideo){document.getElementById("playerWrapper").hidden=true;document.getElementById("controls").hidden=true;document.getElementById("done").hidden=false;document.getElementById("about").hidden=true;player.pauseVideo()}}function prevSelect(){if(hasVidParam){redirectToHome();return}while(currentVideoIndex-1>0){currentVideoIndex--;localStorage.setItem(ids[currentVideoIndex],"sv");if(!blockedChannels.includes(cids[currentVideoIndex])&&!seenVideos.includes(ids[currentVideoIndex])){lastSkipTime=Date.now();player.loadVideoById(ids[currentVideoIndex]);document.getElementById("videoLink").value="https://share.obscuretube.com/?v="+ids[currentVideoIndex];document.getElementById("channelCount").innerHTML=getVideoCountForChannel();autoSkipWasEnabled=document.getElementById("autoSkipCheck").checked;autoSkipDisable();break}}}function copyVideoLink(){var copyText=document.getElementById("videoLink");copyText.select();copyText.setSelectionRange(0,99999);navigator.clipboard.writeText(copyText.value)}function blockChannel(){if(hasVidParam){redirectToHome();return}localStorage.setItem(cids[currentVideoIndex],"bc");blockedChannels.push(cids[currentVideoIndex]);nextSelect()}function resetCache(){localStorage.clear();location.reload()}function checkKey(e){e=e||window.event;if(e.keyCode=="37"){prevSelect()}else if(e.keyCode=="39"){nextClicked()}else if(e.keyCode=="66"){blockChannel()}else if(e.keyCode=="65"){autoSkipClick()}}function shuffle(array){let i=array.length;while(i--){const ri=Math.floor(Math.random()*i);[array[i],array[ri]]=[array[ri],array[i]]}return array}function setPlayerSize(){document.getElementById("playerWrapper").style.height=Math.min(window.innerHeight*.7,window.innerWidth/9*18)+"px";document.getElementById("about").style.height=Math.min(window.innerHeight*.7,window.innerWidth/9*18)+"px";document.getElementById("sharedContext").style.height=Math.min(window.innerHeight*.7,window.innerWidth/9*18)+"px"}function toggleAbout(){document.getElementById("about").hidden=!document.getElementById("about").hidden}function hideAbout(){document.getElementById("about").hidden=true}window.addEventListener("resize",setPlayerSize);window.onload=function(){function loadJSON(callback){var xobj=new XMLHttpRequest;xobj.overrideMimeType("application/json");xobj.open("GET","https://share.obscuretube.com/obscure.json",true);xobj.onreadystatechange=function(){if(xobj.readyState==4&&xobj.status=="200"){callback(JSON.parse(xobj.responseText))}};xobj.send(null)}loadJSON(function(json){ids=[];cids=[];descs=[];var shuffledData=shuffle(json.data);shuffledData.forEach(function(value,i){ids.push(value.id);cids.push(value.cid);descs.push(value.desc)});var newMetadata=localStorage.getItem("metadata")!=json.metadata;for(var i=localStorage.length;i>=0;i--){var key=localStorage.key(i);var value=localStorage[key];if(value=="bc"){blockedChannels.push(key);console.log("blocked channel:"+key)}else if(value=="sv"){if(newMetadata){localStorage.removeItem(key);console.log("clearing seen video:"+key)}else{seenVideos.push(key);console.log("seen video:"+key)}}else{}}function checkFlag(){if(playerReady===false){if(!player){onYouTubeIframeAPIReady()}window.setTimeout(checkFlag,100)}else{localStorage.setItem("metadata",json.metadata);document.getElementById("queueCount").innerHTML="Last generated queue of "+ids.length+" videos on "+json.metadata;var query_string=window.location.search.substring(1);var param_vid=parse_query_string(query_string).v;if(param_vid){player.loadVideoById(param_vid);document.getElementById("videoLink").value="https://share.obscuretube.com?v="+param_vid;hasVidParam=true}else{nextSelect()}player.playVideo()}}checkFlag();localStorage.setItem(ids[0],"sv")});console.log(localStorage);var query_string=window.location.search.substring(1);if(!parse_query_string(query_string).v){document.getElementById("about").hidden=false}setPlayerSize();document.getElementById("playerWrapper").hidden=false;document.getElementById("controls").hidden=false;document.getElementById("resetCache").hidden=false;document.onkeydown=checkKey;document.getElementById("copyLinkButton").addEventListener("click",function(clicked){return function(){if(!clicked){var last=this.innerHTML;this.innerHTML="Copied to Clipboard!";clicked=true;setTimeout(function(){this.innerHTML=last;clicked=false}.bind(this),2e3)}}}(false),this);window.setInterval(skipVideoTimer,1e3);function skipVideoTimer(){var chk=document.getElementById("autoSkipCheck").checked;var seconds=document.getElementById("autoSkipVal").value;var now=Date.now();if(player!=null&&player.getPlayerState()!=2&&chk&&seconds!=""&&now>=lastSkipTime+seconds*1e3){nextSelect()}}};